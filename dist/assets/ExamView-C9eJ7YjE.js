import{d as K,u as W,l as k,m as C,w as X,h as Y,p as Z,c as i,i as t,q as f,s as p,n as c,t as d,k as $,F as ee,j as te,o as l}from"./vue-BoVV1TXU.js";import{u as re}from"./question-BHdgvkCv.js";import{_ as ne}from"./index-C7RP-c2-.js";import"./lodash-CqkleIqs.js";const oe=K({__name:"ExamView",setup(B,{expose:r}){r();const n=re(),e=W(),g=k(""),v=k(!1),b=k(!1),w=k(!1),h=k("off"),u=C(()=>n.currentChapter),y=C(()=>n.currentQuestionSet),x=C(()=>n.currentQuestion),E=C(()=>y.value?n.currentQuestionIndex/y.value.questions.length*100:0),_=C(()=>y.value?n.currentQuestionIndex===y.value.questions.length-1:!1),N=C(()=>x.value?n.getQuestionCorrectRate(x.value.id):0);X(x,()=>{g.value="",v.value=!1});function S(o){o.preventDefault(),g.value&&(_.value?I():M())}function Q(o){const s=o.target,m=document.querySelector("[data-skip-menu-button]"),a=document.querySelector("[data-skip-menu-dropdown]");m&&a&&!m.contains(s)&&!a.contains(s)&&(w.value=!1)}Y(()=>{window.addEventListener("contextmenu",S),window.addEventListener("click",Q)}),Z(()=>{window.removeEventListener("contextmenu",S),window.removeEventListener("click",Q)});function L(o){var s;if(g.value){o===((s=x.value)==null?void 0:s.correctOptionId)&&(_.value?I():M());return}g.value=o,x.value&&(v.value=o===x.value.correctOptionId,n.recordAnswer(x.value.id,o,v.value))}function A(o){var s;return g.value?o===((s=x.value)==null?void 0:s.correctOptionId)?"border-green-500 bg-green-50":o===g.value?"border-red-500 bg-red-50":"border-gray-200 opacity-70":"hover:bg-gray-50 border-gray-200"}function T(o){var s;return g.value?o===((s=x.value)==null?void 0:s.correctOptionId)?"bg-green-500 text-white":o===g.value?"bg-red-500 text-white":"bg-gray-200 text-gray-700":"bg-gray-200 text-gray-700"}function j(){if(!x.value)return"";const o=x.value.options.find(s=>{var m;return s.id===((m=x.value)==null?void 0:m.correctOptionId)});return o?o.text:""}function M(){g.value="",v.value=!1,n.moveToNextQuestion()}function I(){var s;console.log("完成题集开始，当前章节:",n.currentChapterId,"当前题集:",n.currentQuestionSetId);const o=n.isCurrentSetAllCorrect&&n.isCurrentSetAllCorrect();if(console.log("当前题集是否全部做对:",o),o){if(h.value==="reading"||h.value==="cloze"){const a=h.value;if(q(a)){g.value="",v.value=!1,console.log(`跳题模式：成功跳转到下一个${a==="reading"?"阅读理解":"完形填空"}题集`);return}else console.log(`跳题模式：没有找到${a==="reading"?"阅读理解":"完形填空"}题集，使用默认逻辑`)}const m=n.moveToNextQuestionSet();console.log("移动到下一个题集结果:",m),m.success&&!m.reset?(g.value="",v.value=!1,console.log("全部做对，进入下一个题集:",(s=n.currentQuestionSet)==null?void 0:s.title)):(n.resetCurrentSetProgress(),g.value="",v.value=!1,console.log("已完成所有题集，重新开始当前题集"))}else n.resetCurrentSetProgress(),g.value="",v.value=!1,console.log("未全部做对，重新开始当前题集，当前问题索引:",n.currentQuestionIndex);n.currentQuestionIndex!==0&&(console.warn("问题索引未正确重置，强制设置为0"),n.currentQuestionIndex=0),console.log("完成题集结束，当前章节:",n.currentChapterId,"当前题集:",n.currentQuestionSetId,"当前问题索引:",n.currentQuestionIndex)}function R(){e.push("/")}function H(){n.toggleChineseDisplay()}function V(o){return o.toFixed(1)}function D(o){return o===0?"text-gray-500":o<60?"text-red-500":o<80?"text-yellow-500":"text-green-500"}function P(){b.value=!b.value}function F(){w.value=!w.value}function G(o){h.value=o,w.value=!1}function U(){switch(h.value){case"reading":return"bg-green-100 text-green-700 hover:bg-green-200";case"cloze":return"bg-blue-100 text-blue-700 hover:bg-blue-200";default:return"bg-gray-100 text-gray-700 hover:bg-gray-200"}}function J(){switch(h.value){case"reading":return"跳题模式: 阅读理解";case"cloze":return"跳题模式: 完形填空";default:return"跳题模式: 关闭"}}function q(o){const s=[];n.chapters.forEach(a=>{a.questionSets.forEach(O=>{s.push({chapterId:a.id,questionSet:O})})});const m=s.findIndex(a=>a.chapterId===n.currentChapterId&&a.questionSet.id===n.currentQuestionSetId);for(let a=m+1;a<s.length;a++)if(s[a].questionSet.type===o)return n.setCurrentChapter(s[a].chapterId),n.setCurrentQuestionSet(s[a].questionSet.id),!0;for(let a=0;a<=m;a++)if(s[a].questionSet.type===o)return n.setCurrentChapter(s[a].chapterId),n.setCurrentQuestionSet(s[a].questionSet.id),!0;return!1}const z={questionStore:n,router:e,selectedOptionId:g,isCorrect:v,isArticleExpanded:b,showSkipMenu:w,skipMode:h,currentChapter:u,currentSet:y,currentQuestion:x,progressPercentage:E,isLastQuestion:_,questionCorrectRate:N,handleContextMenu:S,handleClickOutside:Q,selectOption:L,getOptionClass:A,getOptionMarkerClass:T,getCorrectOptionText:j,nextQuestion:M,finishQuestionSet:I,goBack:R,toggleChinese:H,formatCorrectRate:V,getCorrectRateClass:D,toggleArticle:P,toggleSkipMenu:F,setSkipMode:G,getSkipModeButtonClass:U,getSkipModeButtonText:J,jumpToNextQuestionSetByType:q};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}}),se={class:"max-w-4xl mx-auto min-h-screen w-full p-2 sm:p-4 flex flex-col h-screen"},ie={class:"flex justify-between items-center mb-4 sm:mb-6"},le={class:"relative"},ae={key:0,"data-skip-menu-dropdown":"",class:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-48"},de={key:0,class:"question-stats px-3 py-1 rounded-full bg-gray-100 text-sm"},ue={class:"flex items-center"},ce={key:0,class:"mb-4 sm:mb-6"},ge={class:"text-xl sm:text-2xl font-bold mb-2"},xe={class:"text-gray-600 text-sm sm:text-base"},fe={class:"progress-info flex items-center mt-4"},me={class:"progress-bar bg-gray-200 h-2 flex-grow rounded-full overflow-hidden"},ve={class:"ml-3 text-sm text-gray-600"},he={class:""},we={class:"flex-1"},pe={class:"text-xl font-semibold"},be={key:0,class:"text-lg text-gray-600 mt-1"},ye={class:"ml-2 p-1 hover:bg-gray-100 rounded transition-colors flex-shrink-0"},Ce={class:"overflow-hidden"},ke={class:"text-base leading-relaxed"},_e={key:0,class:"text-gray-600 mt-4 border-t pt-4 text-base leading-relaxed"},Se={key:1,class:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-white to-transparent pointer-events-none"},Qe={key:1,class:"bg-white rounded-lg shadow-md p-3 sm:p-4 mb-4 flex-grow flex flex-col overflow-hidden min-h-0"},Me={class:"text-base sm:text-lg font-medium mb-4 flex-shrink-0"},Ie={key:0,class:"text-gray-600 mt-1 text-sm sm:text-base"},qe={class:"flex flex-col gap-2 sm:gap-3 overflow-y-auto"},ze=["onClick"],Oe={class:"flex items-start w-full"},Be={key:0,class:"text-white text-sm"},Ee={key:1,class:"text-white text-sm"},Ne={key:2,class:"text-sm font-medium"},Le={class:"flex-1"},Ae={class:"text-sm sm:text-base leading-relaxed"},Te={key:0,class:"text-gray-600 text-xs sm:text-sm mt-1 leading-relaxed"},je={key:1,class:"pb-24 flex-shrink-0 overflow-y-auto"},Re={class:"font-medium"},He={key:0,class:"mt-2"},Ve={key:1,class:"mt-2"},De={class:"flex justify-between fixed bottom-4 left-0 right-0 bg-white p-4 shadow-lg rounded-lg mx-4 z-50"};function Pe(B,r,n,e,g,v){var b,w,h;return l(),i("div",se,[t("div",ie,[t("button",{onClick:e.goBack,class:"back-btn flex items-center text-gray-600 hover:text-gray-900 transition-colors"},r[3]||(r[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z","clip-rule":"evenodd"})],-1),p(" 返回 ")])),t("div",le,[t("button",{onClick:e.toggleSkipMenu,"data-skip-menu-button":"",class:c(["flex items-center px-3 py-1.5 text-sm rounded-lg transition-colors",e.getSkipModeButtonClass()])},[r[4]||(r[4]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z","clip-rule":"evenodd"})],-1)),p(" "+d(e.getSkipModeButtonText()),1)],2),e.showSkipMenu?(l(),i("div",ae,[t("button",{onClick:r[0]||(r[0]=u=>e.setSkipMode("off")),class:c(["w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center",e.skipMode==="off"?"bg-blue-50 text-blue-700":""])},[(l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",class:c(["h-4 w-4 mr-2",e.skipMode==="off"?"text-blue-600":"text-gray-400"]),viewBox:"0 0 20 20",fill:"currentColor"},r[5]||(r[5]=[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"},null,-1)]),2)),r[6]||(r[6]=p(" 关闭跳题模式 "))],2),t("button",{onClick:r[1]||(r[1]=u=>e.setSkipMode("reading")),class:c(["w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center",e.skipMode==="reading"?"bg-green-50 text-green-700":""])},[(l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",class:c(["h-4 w-4 mr-2",e.skipMode==="reading"?"text-green-600":"text-gray-400"]),viewBox:"0 0 20 20",fill:"currentColor"},r[7]||(r[7]=[t("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]),2)),r[8]||(r[8]=p(" 自动跳转阅读理解 "))],2),t("button",{onClick:r[2]||(r[2]=u=>e.setSkipMode("cloze")),class:c(["w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center",e.skipMode==="cloze"?"bg-blue-50 text-blue-700":""])},[(l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",class:c(["h-4 w-4 mr-2",e.skipMode==="cloze"?"text-blue-600":"text-gray-400"]),viewBox:"0 0 20 20",fill:"currentColor"},r[9]||(r[9]=[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"},null,-1)]),2)),r[10]||(r[10]=p(" 自动跳转完形填空 "))],2)])):f("",!0)]),e.currentQuestion?(l(),i("div",de,[r[11]||(r[11]=t("span",{class:"text-gray-600"},"正确率: ",-1)),t("span",{class:c([e.getCorrectRateClass(e.questionCorrectRate),"font-medium"])},d(e.formatCorrectRate(e.questionCorrectRate))+"% ",3)])):f("",!0),t("div",ue,[r[12]||(r[12]=t("span",{class:"mr-2 text-sm"},"显示中文翻译",-1)),t("button",{onClick:e.toggleChinese,class:c(["toggle-btn w-12 h-6 rounded-full p-1 transition-colors duration-200 ease-in-out",e.questionStore.showChinese?"bg-indigo-600":"bg-gray-300"])},[t("div",{class:c(["toggle-dot bg-white w-4 h-4 rounded-full shadow-md transform duration-200 ease-in-out",e.questionStore.showChinese?"translate-x-6":""])},null,2)],2)])]),e.currentSet?(l(),i("div",ce,[t("h1",ge,d((b=e.currentChapter)==null?void 0:b.title)+" - "+d(e.currentSet.title),1),t("p",xe,d(e.currentSet.description),1),t("div",fe,[t("div",me,[t("div",{class:"progress-fill bg-indigo-600 h-full",style:$({width:`${e.progressPercentage}%`})},null,4)]),t("span",ve,d(e.questionStore.currentQuestionIndex+1)+" / "+d(e.currentSet.questions.length),1)])])):f("",!0),t("div",he,[((w=e.currentSet)==null?void 0:w.type)==="reading"&&e.currentSet.article?(l(),i("div",{key:0,class:c(["hidden sm:block mb-4 bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300",{"max-h-96":e.isArticleExpanded,"max-h-24":!e.isArticleExpanded}])},[t("div",{class:"p-4 pb-2 flex justify-between items-start cursor-pointer",onClick:e.toggleArticle},[t("div",we,[t("h2",pe,d(e.currentSet.article.title),1),e.questionStore.showChinese&&e.currentSet.article.titleCN?(l(),i("h3",be,d(e.currentSet.article.titleCN),1)):f("",!0)]),t("button",ye,[(l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",class:c(["h-5 w-5 transform transition-transform duration-300",{"rotate-180":e.isArticleExpanded}]),viewBox:"0 0 20 20",fill:"currentColor"},r[13]||(r[13]=[t("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]),2))])]),t("div",Ce,[t("div",{class:c(["whitespace-pre-line p-4 pt-0",{"overflow-y-auto max-h-80":e.isArticleExpanded,"overflow-hidden max-h-16 relative":!e.isArticleExpanded}])},[t("p",ke,d(e.currentSet.article.content),1),e.questionStore.showChinese&&e.currentSet.article.contentCN?(l(),i("p",_e,d(e.currentSet.article.contentCN),1)):f("",!0),e.isArticleExpanded?f("",!0):(l(),i("div",Se))],2)])],2)):f("",!0),e.currentQuestion?(l(),i("div",Qe,[t("div",Me,[t("span",null,d(e.currentQuestion.text),1),e.questionStore.showChinese&&e.currentQuestion.textCN?(l(),i("p",Ie,d(e.currentQuestion.textCN),1)):f("",!0)]),t("div",qe,[(l(!0),i(ee,null,te(e.currentQuestion.options,u=>(l(),i("div",{key:u.id,class:c(["p-3 sm:p-4 border rounded-lg cursor-pointer transition-all duration-200 flex items-center min-h-[3rem] sm:min-h-[3.5rem] hover:border-indigo-500",[e.getOptionClass(u.id),{"hover:border-gray-200":e.selectedOptionId}]]),onClick:y=>e.selectOption(u.id)},[t("div",Oe,[t("div",{class:c(["w-6 h-6 rounded-full flex items-center justify-center mr-3 flex-shrink-0 transition-colors duration-200",e.getOptionMarkerClass(u.id)])},[e.selectedOptionId&&u.id===e.currentQuestion.correctOptionId?(l(),i("span",Be," ✓ ")):e.selectedOptionId&&u.id===e.selectedOptionId&&u.id!==e.currentQuestion.correctOptionId?(l(),i("span",Ee," ✗ ")):(l(),i("span",Ne,d(u.id.slice(-1)),1))],2),t("div",Le,[t("div",Ae,d(u.text),1),e.questionStore.showChinese&&u.textCN?(l(),i("div",Te,d(u.textCN),1)):f("",!0)])])],10,ze))),128))])])):f("",!0)]),e.selectedOptionId?(l(),i("div",je,[t("div",{class:c(["result-message p-4 rounded-lg mb-4",e.isCorrect?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},[t("div",Re,d(e.isCorrect?"回答正确！":"回答错误！"),1),e.isCorrect?f("",!0):(l(),i("div",He,[r[14]||(r[14]=t("span",{class:"font-medium"},"正确答案：",-1)),p(" "+d(e.getCorrectOptionText()),1)])),(h=e.currentQuestion)!=null&&h.explanation?(l(),i("div",Ve,[r[15]||(r[15]=t("span",{class:"font-medium"},"解析：",-1)),p(" "+d(e.currentQuestion.explanation),1)])):f("",!0)],2),t("div",De,[r[16]||(r[16]=t("div",{class:"flex items-center text-gray-500 text-sm"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 2a8 8 0 100 16 8 8 0 000-16zM6.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm7 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z","clip-rule":"evenodd"})]),t("span",null,"点击鼠标右键进入下一题")],-1)),e.isLastQuestion?(l(),i("button",{key:0,onClick:e.finishQuestionSet,class:"px-3 py-1.5 sm:px-4 sm:py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm sm:text-base"}," 完成 ")):(l(),i("button",{key:1,onClick:e.nextQuestion,class:"px-3 py-1.5 sm:px-4 sm:py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm sm:text-base"}," 下一题 "))])])):f("",!0)])}const Ke=ne(oe,[["render",Pe],["__scopeId","data-v-95f81afa"],["__file","D:/ENGLISH_exam/vue3-Ts-Tailwind-template/src/views/ExamView.vue"]]);export{Ke as default};
